{% extends "base.html" %}
{% load custom_tags %}

{% block title %}Favarite Products{% endblock title %}

{% block body %}

<main class="flex-grow flex justify-center items-center">
    
    <main>
    <section class="py-8 antialiased md:py-12">
        <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">
            <div class="mb-4 md:mb-8  ">
            {% for product in products %}
            <div id="favoriteItem{{ product.slug }}" class="my-3 flex-col md:flex-row flex items-center rounded-lg border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-700 dark:bg-gray-800">
                <div class="p-3">
                    <a href="#">
                        <img class="w-60" src="{{ product.image.url }}" alt="{{ product.name }}"/>
                    </a>
                </div>
                <div>
                <div class="mb-4 flex items-center justify-between gap-4">
                    <a href="{% url "product:list" %}?category={{ product.category.name }}" class="me-2 rounded bg-primary-100 px-2.5 py-0.5 text-xs font-medium text-primary-800 dark:bg-primary-900 dark:text-primary-300">{{ product.category.name }}</a>
        
                    <div class="flex items-center justify-end gap-1">
                    <button id="product-1" type="button" data-tooltip-target="RemoveLike{{ product.slug }}" class="rounded-lg p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                        <span class="sr-only"> Add to Favorites </span>
                        <svg class="w-5 h-5 text-rose-700" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                        <path d="m12.75 20.66 6.184-7.098c2.677-2.884 2.559-6.506.754-8.705-.898-1.095-2.206-1.816-3.72-1.855-1.293-.034-2.652.43-3.963 1.442-1.315-1.012-2.678-1.476-3.973-1.442-1.515.04-2.825.76-3.724 1.855-1.806 2.201-1.915 5.823.772 8.706l6.183 7.097c.19.216.46.34.743.34a.985.985 0 0 0 .743-.34Z"/>
                        </svg>    
                    </button>
                    <divrole="tooltip" class="tooltip invisible absolute z-10 inline-block rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white opacity-0 shadow-sm transition-opacity duration-300 dark:bg-gray-700" data-popper-placement="top">
                        Add to favorites
                        <div class="tooltip-arrow" data-popper-arrow=""></div>
                    </divrole=>
                    </div>
                </div>
        
                <a href="{{ product.get_absolute_url }}" class="text-lg font-semibold leading-tight text-gray-900 hover:underline dark:text-white">{{ product.name }}</a>
        
                <div class="mt-2 flex items-center gap-2">
                    <div class="flex items-center">
                        {% for i in loop_rating %}
                        {% if i <= product.average_score %}
                        <svg class="h-4 w-4 text-yellow-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M13.8 4.2a2 2 0 0 0-3.6 0L8.4 8.4l-4.6.3a2 2 0 0 0-1.1 3.5l3.5 3-1 4.4c-.5 1.7 1.4 3 2.9 2.1l3.9-2.3 3.9 2.3c1.5 1 3.4-.4 3-2.1l-1-4.4 3.4-3a2 2 0 0 0-1.1-3.5l-4.6-.3-1.8-4.2Z" />
                        </svg>
                        {% else %}
                        <svg class="w-4 h-4 text-gray-300 dark:text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20">
                            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"></path>
                        </svg>
                        {% endif %}
                    {% endfor %}
                    </div>
        
                    <p class="text-sm font-medium text-gray-900 dark:text-white">{{ product.average_score|floatformat:1 }}</p>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">({{ product.comments.count }})</p>
                </div>
                {% if product.price_after_discount %}
            <div class="my-4 flex items-center justify-between">
                <div class="flex">
                <p class="text-xl line-through me-2">${{ product.price }}</p>
                <p class="text-2xl font-extrabold leading-tight text-gray-900 dark:text-white">${{ product.price_after_discount }}</p>
                </div>
                <span class="me-2 rounded bg-red-100 px-2.5 py-0.5 text-xs font-light text-red-800 dark:bg-red-900 dark:text-red-300">{{ product.discount_percentage }}% off</span>
            </div>
            {% else %}
            <div class="my-4 flex items-center justify-between">
                <div class="flex">
                <p class="text-2xl font-extrabold leading-tight text-gray-900 dark:text-white">${{ product.price }}</p>
                </div>
            </div>
            {% endif %}
                </div>
            </div>
            {% endfor %}

            </div>
            
    <div class="w-full">
        <ul class="flex items-center justify-center -space-x-px h-10 text-base">
            {% if page_obj.has_previous %}
            <li>
                <a href="?page={{ products.previous_page_number }}&{{ request.GET|remove_page_param }}" class="flex items-center justify-center px-4 h-10 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    <span class="sr-only">Previous</span>
                    <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4" />
                    </svg>
                </a>
            </li>
            {% endif %}
            {% for page_number in page_obj.paginator.page_range %}
            <li>
                {% if page_number == page_obj.number %}
                <a href="?page={{ page_number }}&{{ request.GET|remove_page_param }}" aria-current="page" class="z-10 flex items-center justify-center px-4 h-10 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white">
                    {{ page_number }}
                </a>
                {% else %}
                <a href="?page={{ page_number }}&{{ request.GET|remove_page_param }}" class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    {{ page_number }}
                </a>
                {% endif %}
            </li>
            {% endfor %}

            {% if page_obj.has_next %}
            <li>
                <a href="?page={{ page_obj.next_page_number }}&{{ request.GET|remove_page_param }}" class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    <span class="sr-only">Next</span>
                    <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4" />
                    </svg>
                </a>
            </li>
            {% endif %}
        </ul>
    </div>
        </div>
        </section>      
</main>

</main>

{% endblock body %}

{% block script-section %}
<script>
    svg_unlikd = '<svg class="h-5 w-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6C6.5 1 1 8 5.8 13l6.2 7 6.2-7C23 8 17.5 1 12 6Z" /></svg>'
    const removefavoriteButtons = document.querySelectorAll(
    '[data-tooltip-target^="RemoveLike"]'
    );  

    removefavoriteButtons.forEach((button) => {
    button.addEventListener("click", (event) => {
        const itemId = button.dataset.tooltipTarget.split("RemoveLike")[1];
        unlikeProduct(itemId);
        const itemElement = document.querySelector(`#favoriteItem${itemId}`);
        itemElement.remove();
    });
    });

function unlikeProduct(productSlug) {
    fetch(`/api/products/${productSlug}/like/`, {
        method: "DELETE",
        headers: {
            "X-CSRFToken": getCookie("csrftoken"),
        },
    })
    .then((response) => {
        if (response.ok) {
        } else {
            throw new Error("Failed to unlike the product");
        }
    })
    .catch((error) => {
        console.error(error);
    });
  }
  
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
  }
  
</script>
{% endblock script-section %}